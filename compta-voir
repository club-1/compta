#!/bin/bash

export PS3="Entrez le num√©ro correspondant :"
IFS=$'\n'
data=$(cat /var/compta/transactions.tsv)
comptes=$(cut -f 4 /var/compta/transactions.tsv | sort -u)
comptes=$'tout voir\n'$comptes
# unset -v IFS

echo 'üè∑Ô∏è  Quelle cat√©gorie ?'
select categorie in 'tout voir' 'adhesion' 'infra' 'don' 'autre'
do
    echo '--------------------------------------------------'
    if [[ $REPLY -ne 1 ]]
    then
        filtercategory=true
        data=$(echo "$data" | awk -F $'\t' -v categorie="$categorie" '$6==categorie')	#filtre les entr√©es par nom ducompte
    else
        filtercategory=false
    fi

break
done


echo 'üë• Voulez vous filtrer les comptes ?'
select name in $comptes
do
    echo '--------------------------------------------------'
    if [[ $REPLY -eq 1 ]]
    then
        filteraccount=false
    else
        filteraccount=true
        data=$(echo "$data" | awk -F $'\t' -v name="$name" '$4==name')	#filtre les entr√©es par nom ducompte
    fi

break
done


echo 'üî© Options suppl√©mentaires'
select option in 'peu importe' 'seulement les transactions effectu√©s' 'seulement les transactions pas encore effectu√©s'
do
    echo '--------------------------------------------------'
    case $option in
        'peu importe')
            filterchecked=false
            ;;
        'seulement les transactions effectu√©s')
            filterchecked=true
            data=$(echo "$data" | awk -F $'\t' '$5=="x"')
            ;;
        'seulement les transactions pas encore effectu√©s')
            filterchecked=true
            data=$(echo "$data" | awk -F $'\t' '$5==""')
            ;;
    esac
break
done

cat <<EOF

 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê 
 ‚îÇ           üí∞Ô∏è           T R A N S A C T I O N S             üìà            ‚îÇ 
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò 

EOF

if [ "$filtercategory" = true ]
then
    echo "üè∑Ô∏è  parmis la cat√©gorie '${categorie}'"
fi

if [ "$filteraccount" = true ]
then
    echo "üë• vers le compte de ${name}"
fi

if [ "$filterchecked" = true ]
then
    echo "‚úÖ ${option}"
fi

echo
echo "$data" | column -N id,date,montant,compte,effectu√©,cat√©gorie,intitul√© -ts $'\t'
echo
echo -e "‚öñÔ∏è  \033[1mbalance :\033[00m"
echo "$data" | cut -f 3 | awk '{t=t+$1} END{print t}'
echo
