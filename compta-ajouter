#!/bin/bash
export PS3="Entrez le num√©ro correspondant :"

lastId=$(cut -f 1 /var/compta/transactions.tsv | tail -n 1)
id=$(($lastId + 1))

echo "üìù C'est parti pout ajouter la transaction n¬∞ $id !"
echo '==================================================='
echo '(Vous pouvez annuler √† tout moment en tapant CTRL + C)'
echo
echo "üìÖ √† quelle date ? (au format YYYY-MM-DD) lasser vide pour aujourd'hui"
read date
if test -z "$date"
then
	date=$(date +%Y-%m-%d)
	echo "$date"
fi
echo "üí∂ Quel montant ? (indiquer + ou - devant le nombre)"
read argent
echo "üí∞ compte ayant re√ßu l'argent ?"
IFS=$'\n'
options=$(cut -f 4 /var/compta/transactions.tsv | sort -u)
options=$options$'\ncr√©er un nouveau compte'
select compte in $options
do echo "vous avez choisi $compte"
break
done
unset -v IFS
# tester si la variable vaut "cr√©er un nouveau compte"
if test "$compte" == 'cr√©er un nouveau compte'
then
	echo "üë§ nom du nouveau compte ?"
	read compte
fi
echo "‚úÖ le payment a-t-il √©t√© effectu√© ? (oui/non)"
read effectue
case $effectue in

	yes | oui | o | y)
	effectue='x'
	;;
	no | non | n)
	effectue=''
	;;
	*)
    	echo "üóëÔ∏è  transaction annul√©e"
    	exit 2	
	;;

esac
echo "üóÇÔ∏è  Quelle cat√©gorie ?"
select categorie in adhesion infra don autre
do echo "vous avez choisi $categorie"
break
done
echo "üè∑Ô∏è  intitul√© ?"
read intitule
echo 'üßæ R√©sum√© de la transaction :'
echo '----------------------------------------------------'
transaction=$"$id	$date	$argent	$compte	$effectue	$categorie	$intitule"
echo "$transaction" | column -N id,date,montant,nom,effectu√©,cat√©gorie,intitul√© -ts $'\t'
echo '----------------------------------------------------'
echo "‚úíÔ∏è  Voulez vous ajouter cette transaction ? (oui/non)"
read consent
case $consent in

	yes | oui | o | y)
	consent='x'
	;;
	*)
	effectue=''
    	echo "üóëÔ∏è  transaction annul√©e"
    	exit 2
	;;

esac
echo "$transaction" >> /var/compta/transactions.tsv
echo "‚ú® Transaction ajout√©e ! Merci $USER et bonne journ√©e"
